<!DOCTYPE html>

<html lang="id">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Uji KTT - Kepala Teknik Tambang (60 menit)</title>

  <style>

    :root{

      --bg:#0f172a; --card:#0b1220; --accent:#0ea5ff; --muted:#94a3b8; --success:#16a34a; --danger:#dc2626;

      color-scheme: dark;

    }

    *{box-sizing:border-box}

    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#020617 0%,#071033 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;}

    .wrap{width:100%;max-width:1000px;}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}

    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}

    h1{margin:0;font-size:20px;color:#fff}

    .controls{display:flex;gap:8px;align-items:center}

    .btn{background:var(--accent);color:#022;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600;}

    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .btn.danger{background:var(--danger);color:#fff}

    .statusline{color:var(--muted);font-size:14px}

    .meta{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:14px}

    #timer{font-weight:700;color:var(--accent)}

    .section{margin-top:12px}

    .form-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}

    input[type="text"], input[type="email"]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#e6eef8;min-width:200px}

    .quiz{margin-top:12px;max-height:58vh;overflow:auto;padding-right:8px}

    .question{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02)}

    .qtext{font-weight:700;margin-bottom:8px;color:#f8fafc}

    .options{display:flex;flex-direction:column;gap:8px}

    .option{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.01);cursor:pointer;border:1px solid transparent;transition:all .12s;user-select:none}

    .option:hover{transform:translateY(-3px)}

    .option input{margin-right:8px}

    .option.correct{background:rgba(22,163,74,0.12);border-color:rgba(16,185,129,0.18);color:var(--success)}

    .option.wrong{background:rgba(220,38,38,0.08);border-color:rgba(220,38,38,0.14);color:var(--danger)}

    .small{font-size:13px;color:var(--muted)}

    #result{margin-top:10px;text-align:center;font-weight:700;color:var(--accent)}

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:12px}

    .note{font-size:13px;color:var(--muted)}

    .hidden{display:none}

    @media (max-width:720px){ .meta{flex-direction:column;align-items:flex-start;gap:6px} header{flex-direction:column;align-items:flex-start;gap:8px} }

  </style>

</head>

<body>

  <div class="wrap">

    <div class="card" role="application" aria-labelledby="title">

      <header>

        <div>

          <h1 id="title">Uji Kompetensi Kepala Teknik Tambang — Mode Ujian (PT Waja Inti Lestari)</h1>

          <div class="statusline">Durasi ujian: <strong>60 menit</strong>. Jawaban tampil langsung saat dipilih.</div>

        </div>

        <div class="meta">

          <div>Waktu tersisa: <span id="timer">60:00</span></div>

          <div>Soal terjawab: <span id="answeredCount">0</span>/30</div>

          <div>Skor: <span id="score">0</span></div>

        </div>

      </header>



      <!-- FORM NAMA & EMAIL PESERTA -->

      <div class="section card" style="margin-bottom:12px;background:transparent;border:0;padding:0">

        <div style="margin-bottom:8px" class="small">Masukkan nama & email peserta sebelum memulai ujian:</div>

        <div class="form-row">

          <input id="participantName" type="text" placeholder="Nama peserta (wajib)" autocomplete="name" />

          <input id="participantEmail" type="email" placeholder="Email peserta (opsional, akan disertakan)" autocomplete="email" />

          <button id="startBtn" class="btn">Mulai Ujian</button>

          <button id="sendBtn" class="btn secondary" disabled>Kirim Jawaban (Manual)</button>

          <button id="resetBtn" class="btn secondary" disabled>Reset (Nonaktif saat ujian)</button>

        </div>

        <div class="small note">Selama ujian aktif, tombol reset & navigasi akan dikunci. Jika menutup tab, ujian dianggap selesai dan hasil dikirim otomatis.</div>

      </div>



      <!-- QUIZ AREA -->

      <div id="quiz" class="quiz" aria-live="polite"></div>



      <p id="result" class="hidden"></p>



      <div class="footer">

        <div class="note">Email hasil akan dikirim ke: <strong>ripanogusman@gmail.com</strong></div>

        <div>

          <button id="forceSend" class="btn danger hidden">Kirim Sekarang (paksa)</button>

        </div>

      </div>

    </div>

  </div>



  <!-- EmailJS SDK -->

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>



  <script>

    /***** KONFIG EMAILJS (dari kamu) *****/

    const EMAILJS_SERVICE = 'service_xle8k7s';

    const EMAILJS_TEMPLATE = 'template_3oqbvrq';

    const EMAILJS_PUBLIC_KEY = 'NbaZK_IYI_BIaPtOZ';

    const DEST_EMAIL = 'ripanogusman@gmail.com';

    // Nama pengirim di "From" email

    const SENDER_NAME = 'PT Waja Inti Lestari - Ujian KTT';



    // init EmailJS

    (function(){

      if(window.emailjs) emailjs.init(EMAILJS_PUBLIC_KEY);

    })();



    // ===== Soal 30 (versi final yang kita sepakati) =====

  const quizData = [
{
question: "Perubahan Studi Kelayakan Teknis: Manakah di bawah ini yang BUKAN merupakan faktor yang perlu dipertimbangkan dalam perubahan studi kelayakan secara teknis?",
options: [
"A. Mempunyai lokasi penambangan baru yang sebelumnya belum ada dalam dokumen studi kelayakan.",
"B. Menemukan cadangan baru sehingga merubah umur tambang.",
"C. Adanya penambahan peralatan sehingga meningkatkan tingkat produksi tambang yang sesuai kapasitas produksi dokumen studi kelayakan.",
"D. Adanya perubahan metode penambangan yang disetujui.",
"E. Adanya perubahan batas akhir penambangan."
],
answer: "C"
},
{
question: "Format untuk laporan khusus kajian teknis pertambangan dan teknologi baru terdapat dalam:",
options: [
"A. Kepmen ESDM No 1827 K/30/MEM/2018.",
"B. Kepmen ESDM No 1806 K/30/MEM/2018.",
"C. Kepmen ESDM No 1825 K/30/MEM/2018.",
"D. Kepmen ESDM No 1826 K/30/MEM/2018.",
"E. Peraturan Pemerintah No. 55 Tahun 2010."
],
answer: "A"
},
{
question: "Dalam ketentuan Kepmen ESDM No. 1827.K/30/MEM/2018, pembersihan lahan dilakukan dengan cara penebangan terhadap:",
options: [
"A. Tanaman dengan diameter lebih besar dari 5 (lima) cm.",
"B. Tanaman dengan diameter lebih besar dari 10 (sepuluh) cm.",
"C. Tanaman dengan diameter lebih besar dari 15 (lima belas) cm.",
"D. Tanaman dengan diameter lebih besar dari 20 (dua puluh) cm.",
"E. Seluruh vegetasi tanpa kecuali."
],
answer: "B"
},
{
question: "Kegiatan pengeboran untuk peledakan menggunakan mata bor 200 mm, burden 7,5 m, spasi 8,5 m, subdrill 1,5 m, kedalaman lubang ledak 16,5m. Berapakah stiffness ratio peledakan dan apakah sesuai dengan Kepmen ESDM No.1827.K/30/MEM/2018?",
options: [
"A. Stiffness ratio 2,0, sesuai.",
"B. Stiffness ratio 2,0, tidak sesuai.",
"C. Stiffness ratio 2,2, sesuai dengan Kepmen ESDM No.1827.K/30/MEM/2018.",
"D. Stiffness ratio 2,2, tidak sesuai.",
"E. Stiffness ratio 1,1, sesuai."
],
answer: "C"
},
{
question: "Unjuk kerja peralatan pengolahan dan/atau pemurnian yang terkait dengan waktu kerja, waktu perbaikan, dan waktu standby/tunggu adalah:",
options: [
"A. Physical Availability (PA).",
"B. Mechanical Availability (MA).",
"C. Utilization of Availability (UA).",
"D. Effective Utilization (EU).",
"E. Overall Equipment Effectiveness (OEE)."
],
answer: "A"
},
{
question: "Sumber daya mineral yang dipublikasi secara formal kepada publik atau disampaikan kepada pemerintah untuk keperluan evaluasi adalah:",
options: [
"A. Sumber daya teridentifikasi, terkira, dan terukur.",
"B. Sumber daya tereka, terindikasi, dan terukur.",
"C. Sumber daya tereka, terindikasi, dan terbukti.",
"D. Sumber daya teridentifikasi, terindikasi, dan terukur.",
"E. Sumber daya terindikasi, terukur, dan terbukti."
],
answer: "B"
},
{
question: "Angka recovery pengolahan optimal untuk komoditas bauksit sesuai Lampiran VII Kepmen ESDM No.1827.K/30/MEM/2018 adalah:",
options: [
"A. Paling sedikit 80%.",
"B. Paling sedikit 90%.",
"C. Paling sedikit 85%.",
"D. Paling sedikit 70%.",
"E. Paling sedikit 95%."
],
answer: "C"
},
{
question: "Salah satu faktor pengubah yang berkaitan aspek legal sehingga mengakibatkan cadangan terkira tidak dapat ditingkatkan menjadi cadangan terbukti dan ditetapkan sebagai cadangan marginal, kecuali:",
options: [
"A. Cadangan berada di bawah sungai aktif.",
"B. Cadangan berada di buffer zone.",
"C. Cadangan berada di jalan nasional, provinsi, kabupaten.",
"D. Cadangan berada di bekas lokasi longsoran lereng tambang.",
"E. Cadangan berada di area yang dilarang ditambang sesuai peraturan daerah."
],
answer: "D"
},
{
question: "Yang harus dilakukan KTT jika tidak dapat merencanakan recovery penambangan optimal sesuai Lampiran VII Kepmen ESDM No.1827.K/30/MEM/2018 adalah:",
options: [
"A. Menyampaikan di laporan berkala triwulan konservasi.",
"B. Merevisi Studi Kelayakan.",
"C. Membuat kajian teknis konservasi minerba kepada Direktur Teknik dan Lingkungan/Kepala Inspektur Tambang.",
"D. Membuat laporan kejadian khusus kepada KaIT.",
"E. Tidak perlu dilakukan karena sudah dilaporkan dalam RKAB."
],
answer: "C"
},
{
question: "Kriteria batubara kualitas rendah dari aspek konservasi batubara (Lampiran VII Kepmen ESDM No.1827.K/30/MEM/2018) adalah:",
options: [
"A. Calorific Value 4.500 kkal/kg (gar), Total moisture 40%.",
"B. Calorific Value 4.000 kkal/kg (gar), Total moisture 30%.",
"C. Calorific Value 4.000 kkal/kg (gar), Total moisture 30%.",
"D. Calorific Value 4.000 kkal/kg (gar), Total moisture 40%.",
"E. Calorific Value 4.500 kkal/kg (gar), Total moisture 30%."
],
answer: "D"
},
{
question: "Laporan berkala triwulan yang memuat kegiatan teknis dan konservasi mineral/batubara diatur dalam Lampiran:",
options: [
"A. Lampiran I Kepmen ESDM No.1806.",
"B. Lampiran II Kepmen ESDM No.1806.",
"C. Lampiran II Kepmen ESDM No.1827.",
"D. Lampiran III Kepmen ESDM No.1827.",
"E. Lampiran I Kepmen ESDM No.1827."
],
answer: "E"
},
{
question: "Laporan khusus KTT dalam keadaan khusus yang berkaitan dengan aspek teknis diatur dalam Lampiran:",
options: [
"A. Lampiran I Kepmen ESDM No.1827.",
"B. Lampiran II Kepmen ESDM No.1827.",
"C. Lampiran III Kepmen ESDM No.1827.",
"D. Lampiran IV Kepmen ESDM No.1806.",
"E. Lampiran IV Kepmen ESDM No.1827."
],
answer: "E"
},
{
question: "Yang BUKAN merupakan tugas dan tanggung jawab KTT terkait keselamatan operasi adalah:",
options: [
"A. Mengangkat Pengawas Operasional dan Pengawas Teknik.",
"B. Membuat laporan triwulan keselamatan operasi.",
"C. Menetapkan batas akhir pengoperasian tambang.",
"D. Menunjuk perusahaan jasa pertambangan sebagai pengawas teknik tambang.",
"E. Membuat laporan kejadian keselamatan operasi."
],
answer: "D"
},
{
question: "Setiap KTT wajib memiliki tenaga teknis minimal untuk masing-masing bidang berikut, kecuali:",
options: [
"A. Tenaga teknis geoteknik.",
"B. Tenaga teknis hidrologi.",
"C. Tenaga teknis peledakan.",
"D. Tenaga teknis konservasi.",
"E. Tenaga teknis teknologi informasi."
],
answer: "E"
},
{
question: "Kriteria kecukupan fasilitas untuk pertambangan, kecuali:",
options: [
"A. Adanya ruang penyimpanan alat berat.",
"B. Adanya kantor bagi KTT.",
"C. Adanya laboratorium pengujian.",
"D. Adanya fasilitas komunikasi.",
"E. Adanya fasilitas penanganan keadaan darurat."
],
answer: "A"
},
{
question: "Tugas Pengawas Operasional pada awal shift sebelum memulai pekerjaan adalah:",
options: [
"A. Melaksanakan dan mengawasi setiap kegiatan operasi penambangan.",
"B. Melaporkan kejadian berbahaya kepada KTT.",
"C. Memastikan pekerja menggunakan APD.",
"D. Memeriksa kelayakan operasi alat yang akan digunakan.",
"E. Memberikan pengarahan kepada pekerja terkait bahaya."
],
answer: "D"
},
{
question: "Laporan ketersediaan fasilitas penunjang kegiatan pertambangan dilaporkan dalam laporan berkala triwulan yang terdapat dalam Lampiran:",
options: [
"A. Lampiran I Kepmen ESDM No.1827.",
"B. Lampiran II Kepmen ESDM No.1827.",
"C. Lampiran III Kepmen ESDM No.1827.",
"D. Lampiran IV Kepmen ESDM No.1827.",
"E. Lampiran V Kepmen ESDM No.1827."
],
answer: "C"
},
{
question: "KTT wajib membuat dan menyampaikan laporan khusus jika terjadi keadaan khusus terkait teknis yang dapat mengakibatkan:",
options: [
"A. Peningkatan produksi melebihi 10%.",
"B. Penurunan produksi lebih dari 20%.",
"C. Perubahan desain teknis dan/atau penghentian operasi penambangan.",
"D. Perubahan harga komoditas.",
"E. Perubahan batas wilayah IUP."
],
answer: "C"
},
{
question: "Jika KTT tidak dapat memenuhi kewajiban pengadaan fasilitas penunjang kegiatan pertambangan, maka wajib membuat dan menyampaikan:",
options: [
"A. Laporan triwulan teknis.",
"B. Laporan penghentian operasi.",
"C. Revisi RKAB.",
"D. Revisi studi kelayakan.",
"E. Kajian teknis pengadaan fasilitas penunjang kegiatan pertambangan."
],
answer: "E"
},
{
question: "Penggunaan bahan peledak dilarang pada kegiatan penambangan:",
options: [
"A. Di area terowongan dengan ventilasi buruk.",
"B. Pada jarak < 50 meter dari jalan umum.",
"C. Di wilayah bersebelahan dengan objek vital nasional.",
"D. Di tambang bawah tanah dengan gas metana tinggi.",
"E. Pada cuaca hujan lebat."
],
answer: "C"
},
{
question: "Dalam proses pembukaan lahan penambangan, tahapan kegiatan mencakup:",
options: [
"A. Monitoring jenis tanaman dan pembersihan vegetasi.",
"B. Identifikasi jenis tanaman, pembersihan vegetasi, pengupasan dan pengelolaan cover crop.",
"C. Identifikasi jenis tanaman, pembersihan vegetasi, pengupasan dan pengelolaan lapisan tanah zona pengakaran.",
"D. Identifikasi tanaman, pengupasan lapisan tanah subsoil, dan penempatan tanah pucuk.",
"E. Monitoring tanaman, pengelolaan hasil kayu, pengupasan lapisan tanah zona pengakaran."
],
answer: "C"
},
{
question: "Faktor-faktor yang perlu diperhitungkan pada perencanaan kolam sedimen di area pertambangan adalah:",
options: [
"A. Curah hujan rata-rata tahunan.",
"B. Debit air limpasan daerah tangkapan.",
"C. Ketersediaan dana.",
"D. Jawaban A dan B benar.",
"E. Seluruh jawaban benar."
],
answer: "E"
},
{
question: "Komponen penilaian keberhasilan reklamasi sesuai Lampiran VI Kepmen ESDM No.1827 Tahun 2018, kecuali:",
options: [
"A. Penataan lahan.",
"B. Penanaman tanaman lokal.",
"C. Penutupan tajuk.",
"D. Pembibitan.",
"E. Perawatan."
],
answer: "D"
},
{
question: "Berikut yang bukan komponen biaya pemanfaatan lubang bekas tambang menurut Lampiran VI Kepmen ESDM No.1827 Tahun 2018:",
options: [
"A. Konsultasi pemangku kepentingan.",
"B. Pengamanan lubang bekas tambang.",
"C. Pemulihan dan pemantauan kualitas air.",
"D. Pemeliharaan lubang bekas tambang.",
"E. Stabilisasi lereng."
],
answer: "D"
},
{
question: "Batas toleransi simpangan lubang bor pada kegiatan peledakan di tambang terbuka adalah:",
options: [
"A. 1% dari kedalaman lubang bor.",
"B. 1,5% dari kedalaman lubang bor.",
"C. 2% dari kedalaman lubang bor.",
"D. 2,5% dari kedalaman lubang bor.",
"E. 3% dari kedalaman lubang bor."
],
answer: "C"
},
{
question: "Ketentuan kualifikasi perusahaan jasa pertambangan sesuai Lampiran VIII Kepmen ESDM 1827.K/30/MEM/2018, kecuali:",
options: [
"A. Pemegang IUP menentukan persyaratan administrasi perusahaan jasa pertambangan.",
"B. Perusahaan jasa pertambangan dapat melakukan kegiatan inti sesuai izin.",
"C. Kegiatan noninti dapat dilakukan oleh perusahaan jasa pertambangan berizin.",
"D. Kegiatan inti dapat dilakukan oleh perusahaan jasa pertambangan pemegang IUJP, SKT dan Tanda Registrasi.",
"E. Pemegang IUP/IUPK wajib mengevaluasi kinerja perusahaan jasa pertambangan secara periodik."
],
answer: "D"
},
{
question: "Standar adalah persyaratan teknis atau sesuatu yang dibakukan berdasarkan:",
options: [
"A. Konsensus Pemerintah dan Perusahaan.",
"B. Konsensus semua pihak yang berkepentingan.",
"C. Konsensus Pemerintah dan Akademisi.",
"D. Keputusan Kepala Teknik Tambang.",
"E. Keputusan Direksi."
],
answer: "B"
},
{
question: "Standar Nasional Indonesia adalah:",
options: [
"A. Standar ditetapkan oleh Kementerian ESDM.",
"B. Standar ditetapkan oleh Pemerintah.",
"C. Standar ditetapkan oleh Komite Akreditasi Nasional.",
"D. Standar ditetapkan oleh Badan Standardisasi Nasional (BSN).",
"E. Standar ditetapkan oleh Kepala Inspektur Tambang."
],
answer: "D"
},
{
question: "SNI wajib diterapkan pada kegiatan usaha pertambangan mineral atau batubara, kecuali:",
options: [
"A. SNI 4726:2019 Pedoman pelaporan hasil eksplorasi mineral.",
"B. SNI 5015:2019 Pedoman pelaporan hasil eksplorasi batubara.",
"C. SNI 6350:2016 Demarkasi area pertambangan.",
"D. SNI 7571:2010 Baku tingkat getaran peledakan.",
"E. SNI 13-4726-1998 Klasifikasi sumber daya dan cadangan mineral."
],
answer: "C"
},
{
question: "Yang boleh memiliki Izin Usaha Jasa Pertambangan (IUJP) adalah:",
options: [
"A. Badan Usaha, Koperasi, dan Perseorangan yang juga memiliki IUP, IUPK, atau IPR.",
"B. Badan Usaha, Koperasi, dan Perseorangan yang tidak memiliki IUP, IUPK, IUPK sebagai Kelanjutan Operasi Kontrak/Perjanjian, IPR, SIPB, izin pengangkutan dan penjualan, dan IUP untuk penjualan.",
"C. Hanya Badan Usaha yang memiliki IUJP dan IUP sekaligus.",
"D. Badan Usaha, Koperasi, dan Perseorangan yang tidak memiliki IUP tetapi boleh memiliki IUPK.",
"E. Badan Usaha yang memiliki SKT dari Kepala Inspektur Tambang."
],
answer: "B"
}
];



    // ===== Render soal (input disabled until start) =====

    const quizEl = document.getElementById('quiz');

    quizData.forEach((item, qIdx) => {

      const qDiv = document.createElement('div');

      qDiv.className = 'question';

      qDiv.setAttribute('data-idx', qIdx);



      const qText = document.createElement('div');

      qText.className = 'qtext';

      qText.textContent = item.q;

      qDiv.appendChild(qText);



      const opts = document.createElement('div');

      opts.className = 'options';



      item.a.forEach((optText, optIdx) => {

        const label = document.createElement('label');

        label.className = 'option';

        label.setAttribute('data-opt', optIdx);



        const radio = document.createElement('input');

        radio.type = 'radio';

        radio.name = 'q' + qIdx;

        radio.value = optIdx;

        radio.disabled = true;

        radio.setAttribute('aria-label', optText);



        radio.addEventListener('change', () => {

          handleAnswer(qIdx, optIdx, qDiv);

        });



        label.appendChild(radio);

        const span = document.createElement('span');

        span.textContent = optText;

        label.appendChild(span);

        opts.appendChild(label);

      });



      qDiv.appendChild(opts);

      quizEl.appendChild(qDiv);

    });



    // ===== STATE & TIMER =====

    let examActive = false;

    let timerInterval = null;

    let timeLeft = 60*60;

    const startBtn = document.getElementById('startBtn');

    const sendBtn = document.getElementById('sendBtn');

    const resetBtn = document.getElementById('resetBtn');

    const forceSend = document.getElementById('forceSend');

    const timerEl = document.getElementById('timer');

    const nameInput = document.getElementById('participantName');

    const emailInput = document.getElementById('participantEmail');



    function formatTime(s){const m=Math.floor(s/60).toString().padStart(2,'0');const sec=(s%60).toString().padStart(2,'0');return `${m}:${sec}`;}



    function startExam(){

      const nameVal = nameInput.value.trim();

      if(!nameVal){ alert('Masukkan nama peserta terlebih dahulu.'); nameInput.focus(); return; }

      // activate

      examActive = true;

      // enable inputs

      document.querySelectorAll('input[type=radio]').forEach(inp => inp.disabled = false);

      startBtn.disabled = true;

      startBtn.classList.add('secondary');

      sendBtn.disabled = false;

      resetBtn.disabled = true;

      // block leaving

      window.addEventListener('beforeunload', beforeUnloadHandler);

      // start timer

      timeLeft = 60*60;

      timerEl.textContent = formatTime(timeLeft);

      timerInterval = setInterval(() => {

        timeLeft--;

        timerEl.textContent = formatTime(timeLeft);

        if(timeLeft <= 0){ clearInterval(timerInterval); finishExamAuto(); }

      }, 1000);

    }



    function stopExam(){ examActive=false; clearInterval(timerInterval); window.removeEventListener('beforeunload', beforeUnloadHandler); }



    function beforeUnloadHandler(e){ e.preventDefault(); e.returnValue = 'Ujian sedang berlangsung — meninggalkan halaman akan mengakhiri ujian.'; }



    startBtn.addEventListener('click', startExam);



    // ===== handleAnswer (real-time) =====

    function handleAnswer(questionIndex, selectedIndex, questionDiv){

      if(!examActive) return;

      const labels = Array.from(questionDiv.querySelectorAll('.option'));

      const alreadyAnswered = labels.some(l => l.classList.contains('correct') || l.classList.contains('wrong'));

      if(alreadyAnswered) return;



      labels.forEach(l => { const inp = l.querySelector('input'); if(inp) inp.disabled = true; });

      const correctIndex = quizData[questionIndex].correct;

      const chosenLabel = labels.find(l => Number(l.getAttribute('data-opt')) === selectedIndex);

      if(selectedIndex === correctIndex){ chosenLabel.classList.add('correct'); }

      else { chosenLabel.classList.add('wrong'); const correctLabel = labels.find(l => Number(l.getAttribute('data-opt')) === correctIndex); if(correctLabel) correctLabel.classList.add('correct'); }

      updateScore();

    }



    // ===== score & update =====

    function updateScore(){

      let answered=0, score=0;

      quizData.forEach((it, idx) => {

        const sel = document.querySelector(`input[name='q${idx}']:checked`);

        if(sel) answered++;

        if(sel && Number(sel.value) === it.correct) score++;

      });

      document.getElementById('answeredCount').textContent = answered;

      document.getElementById('score').textContent = score;

      if(answered === quizData.length && examActive){ finishExamAuto(); }

    }



    // ===== build results text =====

    function buildResultsText(){

      let lines=[];

      quizData.forEach((it, idx)=>{

        const sel = document.querySelector(`input[name='q${idx}']:checked`);

        const selText = sel ? it.a[Number(sel.value)] : '(Belum dijawab)';

        const correctText = it.a[it.correct];

        const isCorrect = sel && Number(sel.value) === it.correct;

        lines.push(`${idx+1}. ${it.q}\nJawaban peserta: ${selText}\nJawaban benar: ${correctText}\nHasil: ${isCorrect ? 'Benar' : 'Salah/Belum jawab'}`);

      });

      return lines.join('\n\n');

    }



    // ===== send via EmailJS =====

    function sendResults(manual=false){

      sendBtn.disabled = true;

      forceSend.classList.add('hidden');

      const score = Number(document.getElementById('score').textContent) || 0;

      const answeredCount = Number(document.getElementById('answeredCount').textContent) || 0;

      const timeTakenSeconds = (60*60) - timeLeft;

      const timeTaken = `${Math.floor(timeTakenSeconds/60)} menit ${timeTakenSeconds%60} detik`;

      const resultsText = buildResultsText();

      const participantName = nameInput.value.trim() || 'Nama tidak diisi';

      const participantEmail = emailInput.value.trim() || '(tidak diisi)';



      const templateParams = {

        from_name: SENDER_NAME,

        from_email: 'no-reply@waja-inti.local',

        to_email: DEST_EMAIL,

        participant_name: participantName,

        participant_email: participantEmail,

        quiz_results: resultsText,

        quiz_score: `${score} / ${quizData.length}`,

        time_taken: timeTaken

      };



      if(window.emailjs && EMAILJS_SERVICE && EMAILJS_TEMPLATE){

        emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, templateParams)

          .then(resp => {

            stopExam();

            document.getElementById('result').classList.remove('hidden');

            document.getElementById('result').textContent = `Hasil berhasil dikirim ke ${DEST_EMAIL}. (Skor: ${score}/${quizData.length})`;

            // lock inputs and allow reset

            document.querySelectorAll('input[type=radio]').forEach(inp => inp.disabled = true);

            startBtn.disabled = true;

            resetBtn.disabled = false;

          }, err => {

            console.error('Gagal kirim email:', err);

            document.getElementById('result').classList.remove('hidden');

            document.getElementById('result').textContent = 'Gagal mengirim hasil. Coba kirim manual atau periksa koneksi.';

            sendBtn.disabled = false;

            forceSend.classList.remove('hidden');

          });

      } else {

        alert('EmailJS belum tersedia. Periksa koneksi atau konfigurasi EmailJS.');

        sendBtn.disabled = false;

        forceSend.classList.remove('hidden');

      }

    }



    // auto finish: waktu habis atau semua terjawab

    function finishExamAuto(){ if(!examActive) return; document.getElementById('result').textContent = 'Waktu habis/semua terjawab, mengirim hasil...'; sendResults(); }



    // manual send

    sendBtn.addEventListener('click', () => {

      if(!examActive){

        if(confirm('Ujian belum dimulai. Kirim hasil saat ini?')) sendResults(true);

      } else {

        if(confirm('Kirim jawaban sekarang? (ujian akan berhenti dan hasil dikirim)')) sendResults(true);

      }

    });



    forceSend.addEventListener('click', () => { sendResults(true); });



    // reset (only allowed when exam not active)

    resetBtn.addEventListener('click', () => {

      if(examActive){ alert('Reset tidak diperbolehkan selama mode ujian aktif.'); return; }

      if(!confirm('Reset semua jawaban?')) return;

      document.querySelectorAll('.option').forEach(opt => {

        opt.classList.remove('correct','wrong');

        const inp = opt.querySelector('input');

        if(inp){ inp.checked=false; inp.disabled=true; }

      });

      document.getElementById('answeredCount').textContent='0';

      document.getElementById('score').textContent='0';

      document.getElementById('result').textContent='';

      timeLeft = 60*60;

      timerEl.textContent = formatTime(timeLeft);

      startBtn.disabled = false;

    });



    // block some keys while exam active (best-effort)

    window.addEventListener('keydown', (e) => {

      if(examActive){

        if((e.ctrlKey && e.key==='w') || (e.ctrlKey && e.key==='r') || e.key==='F5'){

          e.preventDefault();

          alert('Navigasi diblokir selama ujian aktif.');

        }

      }

    });



    // initial states

    document.getElementById('answeredCount').textContent='0';

    document.getElementById('score').textContent='0';

    timerEl.textContent = formatTime(timeLeft);

    // ensure radios disabled until start

    document.querySelectorAll('input[type=radio]').forEach(inp => inp.disabled=true);



    // Optional: if user closes tab, try to auto-send (best-effort)

    window.addEventListener('unload', () => {

      if(examActive){

        // Note: async requests may not complete during unload; EmailJS may not work reliably here.

        // But attempt a synchronous navigator.sendBeacon (not sending EmailJS). Best is user to not close.

      }

    });

  </script>

</body>

</html>
